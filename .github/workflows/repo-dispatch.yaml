name: CI
on: 
  repository_dispatch:
    types: [sample_push]
env:
  GITHUB_TOKEN: "${{secrets.GITHUB_TOKEN}}"
jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: getBranch
        run: |
          echo "hello world"
          echo "GITHUB_REF=$GITHUB_REF"
          echo "GITHUB_ENV=$GITHUB_ENV"
          sed 's/^/&&&/' "$GITHUB_ENV"
          echo "payload: ${{ toJson(github.event.client_payload) }}"
          branch="$(echo "${{ toJson(github.event.client_payload) }}" | fgrep 'branch' | sed 's/.*: //;s/,.*//;s|^|refs/heads/|')"
          echo "branch=$branch"
          #echo "branch=$branch" >> $GITHUB_ENV
          echo "::set-output name=branch::$branch"
          
      - name: Checkout
        uses: actions/checkout@v2.3.4
        with:
          ref: ${{steps.getBranch.outputs.branch}}
          
      - run: |
          git status
          sed 's/^/@@@/' .github/workflows/repo-dispatch.yaml
